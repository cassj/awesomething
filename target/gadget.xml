<?xml version="1.0" encoding="UTF-8"?>
<Module>
    <ModulePrefs
            title="thing"
            author="Cass Johnston"
            author_email="cassjohnston@gmail.com"
            description="Test ap to play with citation data">
        <Require feature="opensocial-0.9" />
        <Require feature="sciverse" />
        <Require feature="hub" />
        <Require feature="org.jquery.core-1.4.2" />
    </ModulePrefs>
    <Content type="html" view="canvas"><![CDATA[<!-- The code for Canvas view is here. -->
<div>Canvas view for thing.</div>]]></Content>
    <Content type="html" view="profile"><![CDATA[<!-- The code for Profile view is here. -->
    <script type='text/javascript'>
      var url = 'http://api.elsevier.com/content';
      var myapikey= 'f766476bf5866a00618a9957289428a9';
      var requestHeaders = {}; 
      
      requestHeaders['X-ELS-APIKey'] = your-API-key; 
      requestHeaders['X-ELS-Authtoken'] = authtoken; 
      requestHeaders['Accept'] = "application/json"; 
       
      var params = {}; 
         params[gadgets.io.RequestParameters.HEADERS] = requestHeaders; 
         // only necessary when using gadgets.io.makeRequest 
         //params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.NONE; 
         //params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON; 
         
      gadgets.io.makeContentApiRequest(url, callback, params);
    
      // Mashup
      function fnCreateMashup() {
        gadgets.sciverse.getContextInfo(fnContextInfoCallback);
      }
      
      function fnContentInfoCallback(response) {
        var search = response.searchQuery;
        var url='http://api.nytimes.com/svc/search/v1/article?query='+search+'&apikey=' + myapikey +
        '&format=jason';
        var params = {
          'href' : url,
          'format' : 'json',
          'authz' : 'none'
        };
        osapi.http.get(params[1]).execute(fnNyTimesCallback);
      }
      
      function fnNyTimesCallback(nytimesResponse) {
        var output= '';
        // using jquery
        $.each(nytimesResponse.content.results,function(l,result) {
          output = output + result.data + '-' + result.title;
        }
      }
      gadgets.io.makeContentApiRequest(url, callback, params);
      //gadgets.util.registerOnLoadHandler(fnCreateMashup);
    </script>

<div>Profile view for thing.</div>]]></Content>
    <Content type="html" view="sciverseResultsView"><![CDATA[<!-- The code for Sciverse Results View view is here. -->
<div>Sciverse Results View view for thing.</div>]]></Content>
</Module>